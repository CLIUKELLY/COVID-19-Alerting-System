<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <Title>Requests</Title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <!-------------
    <link rel="stylesheet" href="css/P2_requests.css">
    <link rel="stylesheet" href="font/iconfont.css">
    ------------->
    <script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<!-------------------------------------------------
    Container: contains Header, content, footer
--------------------------------------------------->

<div id="container" class="bg-body">

    <body class="bg-body">

        <section class="container bg-light">
            <!------------------------------
                Banner
            ------------------------------->
            <div class="container-fluid bg-secondary">
                <p class="text-center fs-1 fw-bold">COVID-19 Public Health Care System</p>
                <p class="text-center fs-2 fw-bold">Administrator Home</p>
            </div>

            <!------------------------------
                Navigation Bar
            ------------------------------->
            <nav class="navbar navbar-expand navbar-light bg-light">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">Select a Table:</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse">
                        <form class="container-fluid justify-content-start">
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button class="btn btn-sm btn-outline-dark me-1" type="button">Person</button>
                                <button class="btn btn-sm btn-outline-dark me-1" type="button">Public Health Worker</button>
                                <button class="btn btn-sm btn-outline-dark me-1" type="button">Facility</button>
                                <button class="btn btn-sm btn-outline-dark me-1" type="button">Facility</button>
                                <button class="btn btn-sm btn-outline-dark me-1" type="button">Region</button>
                                <button class="btn btn-sm btn-outline-dark me-1" type="button">Group Zone</button>
                                <button class="btn btn-sm btn-outline-dark me-1" type="button">Health Recommendation</button>
                            </div>
                        </form>
                    </div>
                </div>
            </nav>

            <div class="container-fluid">
                <!-------------------------------------------------
                        Table to show attributes and tuples
                     ------------------------------------------------->
                <div class="container-fluid">
                    <br>
                    <div class="title">
                        <p class="fs-5"> search for id</p>
                        <div class="search-box">
                            <input class="search" @input="watchInput" v-model="keyword" type="text" placeholder="Please enter ID">
                            <div class="go iconfont icon-sousuo" @click="search()"></div>
                        </div>
                    </div>
                    <!-- <form name="ShoppingList"> -->

                    <table id="table-shopping-cart">
                        <tr class="cartRows">
                            <th class="thead" v-for="(item,a) in headList" :key="a">
                                {{item.name}}
                                <ul class="arrow" @click="sort(a,item)">
                                    <li class="iconfont icon-shangjiantou" :class="!item.isAsc?'on':''"></li>
                                    <li class="iconfont icon-shangjiantou-copy" :class="item.isAsc?'on':''"></li>
                                </ul>
                            </th>
                        </tr>
                        <tr class="cartRows" v-for="(item,b) in bodyList" :key="b">
                            <td>{{item.id}}</td>
                            <td class="product-name">{{item.title}}</td>
                            <td>
                                <input type="button" class="btn-change COLAsub" @click="reduce(b,item.id)" value="-">
                                <span class="qtn-addToCart-COLA">{{item.piority}}</span>
                                <input type="button" class="btn-change COLAadd" @click="add(b,item.id)" value="+">
                            </td>
                            <td class="product-price">{{item.receiver}}</td>
                            <td class="product-subtotal-COLA">{{item.time}}</td>
                            <td class="product-subtotal-COLA">{{item.date}}</td>

                            <td class="product-subtotal-COLA">{{item.urgency}}</td>
                            <td class="product-subtotal-COLA">{{item.status}}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="btn-group" role="group" aria-label="Basic example">
                <button onclick="location.href='P3_fill_form.html'" class="btn-create">Create</button>
                <button class="btn-delete">Delete</button>
                <button onclick="location.href='P4_detailed_info.html'" class="btn-display">Display</button>
                <button onclick="location.href='P4_detailed_info.html'" class="btn-edit">Edit</button>
            </div>


            <!--Footer-->


        </section>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>

        <script src="js/jquery-3.4.1.min.js" type="text/javascript" charset="utf-8"></script>
        <script>
            const regTime = /[0-9\-]{10}/g;
            const regDate = /\d{2}[:]\d{2}[:]\d{2}/g;
            new Vue({
                el: '#container',
                data: {
                    keyword: '',
                    headList: [{
                        id: 1,
                        name: 'ID',
                        isAsc: true,
                        type: 'id'
                    }, {
                        id: 2,
                        name: 'Request Name',
                        isAsc: true,
                        type: 'name'
                    }, {
                        id: 3,
                        name: 'Piority',
                        isAsc: true,
                        type: 'piority'
                    }, {
                        id: 4,
                        name: 'Receiver',
                        isAsc: true,
                        type: 'receiver'
                    }, {
                        id: 5,
                        name: 'Time',
                        isAsc: true,
                        type: 'create_time'
                    }, {
                        id: 6,
                        name: 'Date',
                        isAsc: true,
                        type: 'create_time'
                    }, {
                        id: 7,
                        name: 'Urgency',
                        isAsc: true,
                        type: 'urgency'
                    }, {
                        id: 8,
                        name: 'Status',
                        isAsc: true,
                        type: 'status'
                    }, ],
                    bodyList: [],
                    summaryList: [],
                    page: 1,
                    size: 10,
                    totalSize: 0,
                    currentIndex: 0,
                    summary: 0
                },
                mounted() {
                    this.initData();
                    this.getSummaryData()
                },
                methods: {
                    // Go to previous page
                    previous() {
                        if (this.page <= 1) return;
                        this.page--;
                        this.initData();
                        this.currentIndex = this.page - 1;
                    },
                    // Go to next page
                    next() {
                        if (this.page == this.totalSize) return;
                        this.page++;
                        this.initData();
                        this.currentIndex = this.page;
                        this.currentIndex = this.page - 1;
                    },
                    // Go to page with index of
                    changePage(index) {
                        let current = index + 1;
                        this.currentIndex = index;
                        this.page = current;
                        this.initData();
                    },
                    // To sort all the objects in vue
                    sort(index, item) {
                        this.headList[index].isAsc = !this.headList[index].isAsc;
                        $.ajax({
                            url: proBaseUrl + 'info/sort',
                            data: {
                                id: JSON.parse(localStorage.getItem('userManager')).id,
                                type: JSON.parse(localStorage.getItem('userManager')).user_jobPosition,
                                page: this.page,
                                limit: this.size,
                                attr: item.type,
                                isAsc: item.isAsc
                            },
                            success: (res) => {
                                if (res.code == 0) {
                                    this.bodyList = [];
                                    this.totalSize = Math.ceil(res.count / this.size);
                                    res.data.forEach((item, index) => {
                                        item.time = item.create_time.replace(regTime, '');
                                        item.date = (item.create_time.replace(regDate, '')).replace(/[-]/g, '/');
                                    })
                                    this.bodyList = res.data;
                                } else {

                                }
                            }
                        })
                    },
                    // increase the piorioty level
                    reduce(index, id) {
                        if (this.bodyList[index].piority < 1) {
                            alert('不能再少了~');
                            return;
                        };
                        this.bodyList[index].piority--;
                        this.count(id, 'reduce');
                    },
                    // reduce the piority level
                    add(index, id) {
                        this.bodyList[index].piority++;
                        this.count(id, 'add');
                    },
                    // calculate
                    count(id, type) {
                        $.ajax({
                            url: proBaseUrl + 'info/add',
                            data: {
                                id: id,
                                type: type
                            },
                            success: (res) => {
                                if (res.code == 0) {
                                    console.log(res.msg);
                                } else {
                                    console.log(res.msg);
                                }
                            }
                        })
                    },
                    // Search key words
                    search() {
                        if (this.keyword == '') {
                            alert('Please type in key words');
                            return;
                        }
                        this.page = 1;
                        let that = this;
                        $.ajax({
                            url: proBaseUrl + 'info/search',
                            data: {
                                id: JSON.parse(localStorage.getItem('userManager')).id,
                                type: JSON.parse(localStorage.getItem('userManager')).user_jobPosition,
                                page: this.page,
                                limit: this.size,
                                keyword: that.keyword
                            },
                            success: (res) => {
                                if (res.code == 0) {
                                    if (this.keyword) {
                                        this.bodyList = [];
                                    }
                                    res.data.forEach((item, index) => {
                                        item.time = item.create_time.replace(regTime, '');
                                        item.date = (item.create_time.replace(regDate, '')).replace(/[-]/g, '/');
                                    })
                                    this.bodyList = res.data;
                                    this.totalSize = Math.ceil(res.count / this.size);
                                } else {
                                    this.bodyList = [];
                                    this.totalSize = Math.ceil(res.count / this.size);
                                }
                            }
                        })
                    },
                    // Monitor the textbox for search to see if it's empty
                    watchInput(e) {
                        if (this.keyword == '') {
                            this.initData();
                        }
                    },
                    // To get summary board info
                    getSummaryData() {
                        $.ajax({
                            url: proBaseUrl + 'info/summary',
                            data: {
                                id: JSON.parse(localStorage.getItem('userManager')).id,
                                type: JSON.parse(localStorage.getItem('userManager')).user_jobPosition,
                            },
                            success: (res) => {
                                if (res.code == 0) {
                                    res.data.forEach((item) => {
                                        this.summary += item.value;
                                        this.summaryList.push(item);
                                    })
                                } else {

                                }
                            }
                        })
                    },
                    // Initialize data
                    initData() {
                        $.ajax({
                            url: proBaseUrl + 'info/list',
                            data: {
                                id: JSON.parse(localStorage.getItem('userManager')).id,
                                type: JSON.parse(localStorage.getItem('userManager')).user_jobPosition,
                                page: this.page,
                                limit: this.size
                            },
                            success: (res) => {
                                if (res.code == 0) {
                                    res.data.forEach((item, index) => {
                                        item.time = item.create_time.replace(regTime, '');
                                        item.date = (item.create_time.replace(regDate, '')).replace(/[-]/g, '/');
                                    })
                                    this.bodyList = res.data;
                                    this.totalSize = Math.ceil(res.count / this.size);
                                } else {

                                }
                            }
                        })
                    }
                }
            })
        </script>

    </body>
</div>



</html>